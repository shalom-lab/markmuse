<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarkMuse WeChat - CDN æ–¹å¼æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: 600px;
        }

        .input-panel {
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }

        .output-panel {
            background: white;
        }

        .panel h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #333;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
        }

        textarea {
            width: 100%;
            min-height: 400px;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: "SF Mono", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .preview {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            min-height: 400px;
            background: white;
        }

        /* ç¡®ä¿ä»£ç å—æ ·å¼æ­£ç¡®æ˜¾ç¤º */
        .preview .hljs,
        .preview pre.hljs {
            display: block;
            overflow-x: auto;
            padding: 2.5rem 1rem 1rem 1rem;
            background-color: #2d2d2d;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .preview .hljs code {
            background-color: transparent;
            padding: 0;
            font-size: 0.9em;
            color: #e8e8e8;
            font-family: "SF Mono", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* highlight.js è¯­æ³•é«˜äº®æ ·å¼ï¼ˆä½œä¸ºåå¤‡ï¼‰ */
        .preview .hljs-comment,
        .preview .hljs-quote {
            color: #6a9955;
        }

        .preview .hljs-variable,
        .preview .hljs-template-variable,
        .preview .hljs-tag,
        .preview .hljs-name,
        .preview .hljs-selector-id,
        .preview .hljs-selector-class,
        .preview .hljs-regexp,
        .preview .hljs-deletion {
            color: #f48771;
        }

        .preview .hljs-number,
        .preview .hljs-built_in,
        .preview .hljs-builtin-name,
        .preview .hljs-literal,
        .preview .hljs-type,
        .preview .hljs-params,
        .preview .hljs-meta,
        .preview .hljs-link {
            color: #b5cea8;
        }

        .preview .hljs-attribute {
            color: #9cdcfe;
        }

        .preview .hljs-string,
        .preview .hljs-symbol,
        .preview .hljs-bullet,
        .preview .hljs-addition {
            color: #ce9178;
        }

        .preview .hljs-title,
        .preview .hljs-section {
            color: #dcdcaa;
        }

        .preview .hljs-keyword,
        .preview .hljs-selector-tag {
            color: #569cd6;
        }

        .preview .hljs-emphasis {
            font-style: italic;
        }

        .preview .hljs-strong {
            font-weight: bold;
        }

        .controls {
            padding: 1.5rem;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .status {
            padding: 1rem 1.5rem;
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            margin-bottom: 1rem;
            border-radius: 4px;
        }

        .status.success {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .status.error {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ MarkMuse WeChat</h1>
            <p>CDN æ–¹å¼æµ‹è¯• - æµè§ˆå™¨ç¯å¢ƒ</p>
        </div>

        <div id="status" class="status hidden"></div>

        <div class="content">
            <div class="panel input-panel">
                <h2>ğŸ“ Markdown è¾“å…¥</h2>
                <textarea id="markdownInput" placeholder="è¾“å…¥ Markdown å†…å®¹..."># MarkMuse WeChat æµ‹è¯•

è¿™æ˜¯ä¸€ä¸ª**CDN æ–¹å¼**çš„æµ‹è¯•é¡µé¢ã€‚

## æ–‡æœ¬æ ¼å¼

è¿™æ˜¯**ç²—ä½“æ–‡æœ¬**ï¼Œè¿™æ˜¯*æ–œä½“æ–‡æœ¬*ï¼Œè¿™æ˜¯`è¡Œå†…ä»£ç `ã€‚

## æ•°å­¦å…¬å¼

### è¡Œå†…å…¬å¼

çˆ±å› æ–¯å¦çš„è´¨èƒ½æ–¹ç¨‹ï¼š$E = mc^2$

å‹¾è‚¡å®šç†ï¼š$a^2 + b^2 = c^2$

### å—çº§å…¬å¼

$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

$$
\sum_{i=1}^{n} i = \frac{n(n+1)}{2}
$$

## ä»£ç å—

```javascript
// JavaScript ç¤ºä¾‹
function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

console.log(fibonacci(10)); // 55
```

```python
# Python ç¤ºä¾‹
def quick_sort(arr):
    if len(arr) <= 1:
        return arr
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    return quick_sort(left) + middle + quick_sort(right)
```

## åˆ—è¡¨

- ç¬¬ä¸€é¡¹
- ç¬¬äºŒé¡¹
  - åµŒå¥—é¡¹ 1
  - åµŒå¥—é¡¹ 2
- ç¬¬ä¸‰é¡¹

## è¡¨æ ¼

| åŠŸèƒ½ | æ”¯æŒ | è¯´æ˜ |
|------|------|------|
| Markdown | âœ… | å®Œæ•´æ”¯æŒ |
| æ•°å­¦å…¬å¼ | âœ… | LaTeX è¯­æ³• |
| ä»£ç é«˜äº® | âœ… | highlight.js |

## å¼•ç”¨

> è¿™æ˜¯ä¸€æ®µå¼•ç”¨æ–‡æœ¬ã€‚
> 
> å¯ä»¥åŒ…å«å¤šè¡Œå†…å®¹ã€‚

---

**æµ‹è¯•å®Œæˆï¼** è¿™ä¸ªé¡µé¢ä½¿ç”¨ CDN æ–¹å¼åŠ è½½ markmuse-wechatã€‚</textarea>
            </div>

            <div class="panel output-panel">
                <h2>âœ¨ é¢„è§ˆæ•ˆæœ</h2>
                <div id="preview" class="preview">
                    <p style="color: #999; text-align: center; padding: 2rem;">
                        ç‚¹å‡»"è½¬æ¢"æŒ‰é’®æŸ¥çœ‹é¢„è§ˆæ•ˆæœ
                    </p>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="convert()">
                ğŸ”„ è½¬æ¢
            </button>
            <button class="btn-secondary" onclick="loadExample()">
                ğŸ“„ åŠ è½½ç¤ºä¾‹
            </button>
            <button class="btn-secondary" onclick="clearAll()">
                ğŸ—‘ï¸ æ¸…ç©º
            </button>
            <button class="btn-secondary" onclick="copyToWeChat()">
                ğŸ“‹ å¤åˆ¶åˆ°å¾®ä¿¡å…¬ä¼—å·
            </button>
        </div>
    </div>

    <!-- MathJax é…ç½®å’ŒåŠ è½½ -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            },
            svg: {
                fontCache: 'none'  // å…³é”®ï¼šç”Ÿæˆå®Œæ•´çš„ pathï¼Œä¸ä½¿ç”¨ use å¼•ç”¨
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <!-- MarkMuse WeChat CDN -->
    <script src="https://cdn.jsdelivr.net/npm/markmuse-wechat/dist/bundle.iife.js"></script>

    <script>
        let isConverting = false;
        let lastConvertedHtml = null;  // ä¿å­˜è½¬æ¢åçš„ HTMLï¼Œä¾›å¤åˆ¶åŠŸèƒ½ä½¿ç”¨

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusEl.classList.add('hidden');
                }, 3000);
            }
        }

        async function convert() {
            if (isConverting) {
                showStatus('æ­£åœ¨è½¬æ¢ä¸­ï¼Œè¯·ç¨å€™...', 'info');
                return;
            }

            const markdown = document.getElementById('markdownInput').value.trim();
            
            if (!markdown) {
                showStatus('è¯·è¾“å…¥ Markdown å†…å®¹', 'error');
                return;
            }

            // æ£€æŸ¥ MarkMuse æ˜¯å¦å·²åŠ è½½
            if (!window.MarkMuse || !window.MarkMuse.convertDefault) {
                showStatus('MarkMuse æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ CDN è¿æ¥', 'error');
                return;
            }

            // æ£€æŸ¥ MathJax æ˜¯å¦å·²åŠ è½½
            if (!window.MathJax || typeof window.MathJax.tex2svg !== 'function') {
                showStatus('MathJax æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ CDN è¿æ¥', 'error');
                return;
            }

            isConverting = true;
            const previewEl = document.getElementById('preview');
            previewEl.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="loading"></div>æ­£åœ¨è½¬æ¢...</div>';

            try {
                // ä½¿ç”¨é»˜è®¤æ ·å¼è½¬æ¢
                const html = await window.MarkMuse.convertDefault(markdown);
                
                // ä¿å­˜è½¬æ¢ç»“æœï¼Œä¾›å¤åˆ¶åŠŸèƒ½ä½¿ç”¨
                lastConvertedHtml = html;
                
                previewEl.innerHTML = html;
                showStatus('âœ… è½¬æ¢æˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('è½¬æ¢å¤±è´¥:', error);
                previewEl.innerHTML = `
                    <div style="color: #dc3545; padding: 1rem;">
                        <h3>è½¬æ¢å¤±è´¥</h3>
                        <p>${error.message}</p>
                        <pre style="background: #f8f9fa; padding: 1rem; margin-top: 1rem; border-radius: 4px; overflow-x: auto;">${error.stack}</pre>
                    </div>
                `;
                showStatus('âŒ è½¬æ¢å¤±è´¥ï¼š' + error.message, 'error');
            } finally {
                isConverting = false;
            }
        }

        async function convertWithCustomCss() {
            const markdown = document.getElementById('markdownInput').value.trim();
            const customCss = `
                #markmuse {
                    font-family: "Microsoft YaHei", Arial, sans-serif;
                    color: #2c3e50;
                }
            `;
            
            try {
                const html = await window.MarkMuse.convertDefault(markdown, customCss);
                document.getElementById('preview').innerHTML = html;
                showStatus('âœ… ä½¿ç”¨è‡ªå®šä¹‰æ ·å¼è½¬æ¢æˆåŠŸï¼', 'success');
            } catch (error) {
                showStatus('âŒ è½¬æ¢å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        function loadExample() {
            const example = `# å®Œæ•´ç¤ºä¾‹

## æ•°å­¦å…¬å¼æµ‹è¯•

è¡Œå†…å…¬å¼ï¼š$E = mc^2$ï¼Œ$\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}$

å—çº§å…¬å¼ï¼š
$$
\\int_0^1 x^2 dx = \\frac{1}{3}
$$

$$
\\begin{pmatrix}
a & b \\\\
c & d
\\end{pmatrix}
$$

## ä»£ç ç¤ºä¾‹

\`\`\`javascript
// å¿«é€Ÿæ’åº
function quickSort(arr) {
  if (arr.length <= 1) return arr;
  const pivot = arr[Math.floor(arr.length / 2)];
  const left = arr.filter(x => x < pivot);
  const middle = arr.filter(x => x === pivot);
  const right = arr.filter(x => x > pivot);
  return [...quickSort(left), ...middle, ...quickSort(right)];
}
\`\`\`

## åˆ—è¡¨å’Œè¡¨æ ¼

1. ç¬¬ä¸€é¡¹
2. ç¬¬äºŒé¡¹
3. ç¬¬ä¸‰é¡¹

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ |
|------|------------|
| å†’æ³¡æ’åº | $O(n^2)$ |
| å¿«é€Ÿæ’åº | $O(n \\log n)$ |

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—

**æµ‹è¯•å®Œæˆï¼**`;
            
            document.getElementById('markdownInput').value = example;
            showStatus('ğŸ“„ ç¤ºä¾‹å·²åŠ è½½', 'success');
        }

        function clearAll() {
            document.getElementById('markdownInput').value = '';
            document.getElementById('preview').innerHTML = '<p style="color: #999; text-align: center; padding: 2rem;">ç‚¹å‡»"è½¬æ¢"æŒ‰é’®æŸ¥çœ‹é¢„è§ˆæ•ˆæœ</p>';
            showStatus('ğŸ—‘ï¸ å·²æ¸…ç©º', 'success');
        }

        async function copyToWeChat() {
            const html = lastConvertedHtml;
            
            if (!html) {
                showStatus('è¯·å…ˆè½¬æ¢ Markdown', 'error');
                return;
            }

            try {
                // ä» HTML ä¸­æå–çº¯æ–‡æœ¬
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                const plainText = tempDiv.innerText || tempDiv.textContent || '';

                // è·å–åŸå§‹ Markdown
                const markdown = document.getElementById('markdownInput').value.trim();

                // ä½¿ç”¨ copySafari æ–¹æ³•ï¼ˆæ”¯æŒå¯Œæ–‡æœ¬å’Œå¤šæ ¼å¼ï¼‰
                const success = await copySafari(html, plainText, markdown);

                if (success) {
                    showStatus('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ç°åœ¨å¯ä»¥ç²˜è´´åˆ°å¾®ä¿¡å…¬ä¼—å·ç¼–è¾‘å™¨ä¸­äº†', 'success');
                } else {
                    showStatus('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            } catch (error) {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                showStatus('âŒ å¤åˆ¶å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆå‚è€ƒ lib/test-browser.html çš„ copySafari å®ç°ï¼‰
        function copySafari(html, plainText, markdown) {
            return new Promise((resolve) => {
                let resolved = false;
                
                // è·å–æˆ–åˆ›å»º input å…ƒç´ 
                let input = document.getElementById('copy-input');
                if (!input) {
                    input = document.createElement('input');
                    input.id = 'copy-input';
                    input.style.position = 'absolute';
                    input.style.left = '-1000px';
                    input.style.zIndex = '-1000';
                    document.body.appendChild(input);
                }
                
                // è®© input é€‰ä¸­ä¸€ä¸ªå­—ç¬¦
                input.value = 'NOTHING';
                input.setSelectionRange(0, 1);
                input.focus();
                
                // å¤åˆ¶è§¦å‘
                const copyHandler = (e) => {
                    e.preventDefault();
                    if (e.clipboardData) {
                        e.clipboardData.setData('text/html', html);
                        e.clipboardData.setData('text/plain', plainText || html);
                        if (markdown) {
                            e.clipboardData.setData('text/markdown', markdown);
                        }
                    }
                    document.removeEventListener('copy', copyHandler);
                    if (!resolved) {
                        resolved = true;
                        resolve(true);
                    }
                };
                
                document.addEventListener('copy', copyHandler);
                
                try {
                    const success = document.execCommand('copy');
                    if (!success && !resolved) {
                        setTimeout(() => {
                            if (navigator.clipboard && !resolved) {
                                const textArea = document.createElement('textarea');
                                textArea.value = html;
                                textArea.style.position = 'fixed';
                                textArea.style.left = '-999999px';
                                document.body.appendChild(textArea);
                                textArea.select();
                                try {
                                    document.execCommand('copy');
                                    document.body.removeChild(textArea);
                                    if (!resolved) {
                                        resolved = true;
                                        resolve(true);
                                    }
                                } catch (err) {
                                    document.body.removeChild(textArea);
                                    if (!resolved) {
                                        resolved = true;
                                        resolve(false);
                                    }
                                }
                            } else if (!resolved) {
                                resolved = true;
                                resolve(false);
                            }
                        }, 100);
                    }
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    if (!resolved) {
                        resolved = true;
                        resolve(false);
                    }
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥ä¾èµ–
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.MathJax && typeof window.MathJax.tex2svg === 'function') {
                    showStatus('âœ… MathJax å·²åŠ è½½', 'success');
                } else {
                    showStatus('âš ï¸ MathJax åŠ è½½ä¸­...', 'info');
                }

                if (window.MarkMuse && window.MarkMuse.convertDefault) {
                    showStatus('âœ… MarkMuse å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹è½¬æ¢', 'success');
                } else {
                    showStatus('âš ï¸ MarkMuse åŠ è½½ä¸­...', 'info');
                }
            }, 1000);
        });

        // æ”¯æŒ Ctrl+Enter å¿«æ·é”®è½¬æ¢
        document.getElementById('markdownInput').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                convert();
            }
        });
    </script>
</body>
</html>

