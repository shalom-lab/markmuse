åŸºäº Tauri + React å¼€å‘ Cherry Markdown ç¼–è¾‘å™¨çš„æµç¨‹
æœ¬é¡¹ç›®å°†åŸºäº Tauri + React + IndexedDBï¼Œå¼€å‘ä¸€ä¸ªç±»ä¼¼ Cherry Markdown çš„ç¼–è¾‘å™¨ï¼Œå¹¶å¢å¼ºå¦‚ä¸‹åŠŸèƒ½ï¼š
âœ… æ”¯æŒå¤åˆ¶åˆ°å¾®ä¿¡å…¬ä¼—å·æ ¼å¼
âœ… ä½¿ç”¨ IndexedDB æŒä¹…å­˜å‚¨
âœ… æ”¯æŒæ–°å¢æ–‡ä»¶ã€æ–‡ä»¶å¤¹ï¼Œç®¡ç† Markdown ç»“æ„
âœ… å·¦ä¾§ç›®å½•ï¼Œå³ä¾§ Markdown ç¼–è¾‘ + é¢„è§ˆ
âœ… å¯ç¼–è¾‘ CSS æ¨¡æ¿ï¼Œæ”¯æŒå¤šæ¨¡æ¿ç®¡ç†ã€å¯¼å…¥å¯¼å‡º

ğŸ“Œ å¼€å‘æµç¨‹
ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ– Tauri + React é¡¹ç›®
å®‰è£… Rust å’Œ Tauri å¼€å‘ç¯å¢ƒ

å®‰è£… Rust

å®‰è£… pnpm æˆ– npm

bash
Copy
Edit
npm install -g pnpm  # æˆ–è€…ä½¿ç”¨ npm
åˆ›å»º Tauri + React é¡¹ç›®

bash
Copy
Edit
pnpm create tauri-app my-md-editor
cd my-md-editor
é…ç½® Tauri

bash
Copy
Edit
pnpm tauri init
é€‰æ‹© React ä½œä¸ºå‰ç«¯æ¡†æ¶ã€‚

ç¬¬äºŒæ­¥ï¼šæ­å»º Markdown ç¼–è¾‘å™¨
å®‰è£… Cherry Markdown

bash
Copy
Edit
pnpm add @cherry-markdown/core
å®‰è£… React ç›¸å…³åº“

bash
Copy
Edit
pnpm add react-router-dom dexie
dexieï¼šIndexedDB çš„å°è£…åº“ï¼Œç”¨äºæ–‡ä»¶æŒä¹…å­˜å‚¨ã€‚

react-router-domï¼šç®¡ç†è·¯ç”±ã€‚

åˆ›å»º Markdown ç¼–è¾‘å™¨ç»„ä»¶ åœ¨ src/components/MarkdownEditor.tsx:

tsx
Copy
Edit
import Cherry from "@cherry-markdown/core";
import { useEffect, useRef } from "react";

export default function MarkdownEditor({ content, onChange }) {
  const editorRef = useRef(null);

  useEffect(() => {
    if (!editorRef.current) {
      editorRef.current = new Cherry({
        id: "editor",
        value: content,
        callback: (value) => onChange(value),
      });
    }
  }, []);

  return <div id="editor"></div>;
}
ç¬¬ä¸‰æ­¥ï¼šå®ç°æ–‡ä»¶ç®¡ç†
ä½¿ç”¨ IndexedDB å­˜å‚¨æ–‡ä»¶ç»“æ„

åˆ›å»ºæ•°æ®åº“ src/db.ts:

tsx
Copy
Edit
import Dexie from "dexie";

export const db = new Dexie("markdownEditorDB");
db.version(1).stores({
  files: "++id, name, content, parentId",
  folders: "++id, name, parentId",
});
æ–°å¢æ–‡ä»¶ã€æ–‡ä»¶å¤¹åŠŸèƒ½ åœ¨ src/components/FileManager.tsx:

tsx
Copy
Edit
import { db } from "../db";

async function addFile(name, content = "", parentId = null) {
  await db.files.add({ name, content, parentId });
}

async function addFolder(name, parentId = null) {
  await db.folders.add({ name, parentId });
}
ç¬¬å››æ­¥ï¼šå®ç°ç›®å½•ç»“æ„
å·¦ä¾§ç›®å½•ç»„ä»¶ (src/components/FileTree.tsx):

tsx
Copy
Edit
import { useLiveQuery } from "dexie-react-hooks";
import { db } from "../db";

export default function FileTree({ onSelectFile }) {
  const files = useLiveQuery(() => db.files.toArray(), []);
  
  return (
    <div className="file-tree">
      {files?.map((file) => (
        <div key={file.id} onClick={() => onSelectFile(file)}>
          ğŸ“„ {file.name}
        </div>
      ))}
    </div>
  );
}
ç¬¬äº”æ­¥ï¼šå®ç° Markdown é¢„è§ˆ
Markdown é¢„è§ˆç»„ä»¶ (src/components/Preview.tsx)

tsx
Copy
Edit
import React from "react";
import Markdown from "react-markdown";

export default function Preview({ content }) {
  return <Markdown>{content}</Markdown>;
}
ç¼–è¾‘å™¨ä¸»ç•Œé¢

tsx
Copy
Edit
import { useState } from "react";
import MarkdownEditor from "./MarkdownEditor";
import Preview from "./Preview";
import FileTree from "./FileTree";

export default function EditorPage() {
  const [content, setContent] = useState("");

  return (
    <div className="editor-container">
      <FileTree onSelectFile={(file) => setContent(file.content)} />
      <MarkdownEditor content={content} onChange={setContent} />
      <Preview content={content} />
    </div>
  );
}
ç¬¬å…­æ­¥ï¼šå®ç° CSS æ¨¡æ¿ç®¡ç†
ä½¿ç”¨ IndexedDB å­˜å‚¨ CSS æ¨¡æ¿ åœ¨ src/db.ts:

tsx
Copy
Edit
db.version(2).stores({
  templates: "++id, name, css",
});
æ–°å¢ CSS æ¨¡æ¿åŠŸèƒ½

tsx
Copy
Edit
async function addTemplate(name, css) {
  await db.templates.add({ name, css });
}
async function loadTemplates() {
  return await db.templates.toArray();
}
åº”ç”¨ CSS æ¨¡æ¿

tsx
Copy
Edit
import { useState, useEffect } from "react";
import { db } from "../db";

export default function TemplateManager() {
  const [templates, setTemplates] = useState([]);

  useEffect(() => {
    db.templates.toArray().then(setTemplates);
  }, []);

  return (
    <select onChange={(e) => document.body.style = e.target.value}>
      {templates.map((tpl) => (
        <option key={tpl.id} value={tpl.css}>
          {tpl.name}
        </option>
      ))}
    </select>
  );
}
ç¬¬ä¸ƒæ­¥ï¼šå®ç°ä¸€é”®å¤åˆ¶åˆ°å¾®ä¿¡å…¬ä¼—å·
æ ¼å¼åŒ– Markdown ä¸ºå¾®ä¿¡å…¬ä¼—å·å…¼å®¹çš„ HTML

tsx
Copy
Edit
import TurndownService from "turndown";

function copyToWeChat(content) {
  const turndownService = new TurndownService();
  const html = turndownService.turndown(content);
  navigator.clipboard.writeText(html);
}
æŒ‰é’®è§¦å‘å¤åˆ¶

tsx
Copy
Edit
<button onClick={() => copyToWeChat(content)}>å¤åˆ¶åˆ°å…¬ä¼—å·</button>
ğŸ¯ ç»“è®º
Tauri + React + Cherry Markdown æ­å»ºç¼–è¾‘å™¨ âœ…

IndexedDB æŒä¹…å­˜å‚¨æ–‡ä»¶å’Œ CSS æ¨¡æ¿ âœ…

æ”¯æŒ Markdown é¢„è§ˆ + å¾®ä¿¡å…¬ä¼—å·æ ¼å¼è½¬æ¢ âœ…

å¯ç®¡ç†æ–‡ä»¶ã€æ–‡ä»¶å¤¹ï¼Œæ”¯æŒ CSS ä¸»é¢˜åˆ‡æ¢ âœ…

æœ¬åœ°å¼€å‘åŸºäºvite ï¼Œæ‰“åŒ…åŸºäº tauri(æ‰“åŒ…ä½¿ç”¨github actionå®Œæˆæœ¬åœ°éœ€ç”¨é…ç½®) idbæŒä¹…åŒ–å­˜å‚¨
